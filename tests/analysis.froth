; Test code analysis utilities

"../lib/analysis.froth" import

; Helper to print result using (array 0 | 1) pattern
{ { /fvs fvs println! } { "FAIL" println! } ?! } /show

; Simple identifier
'x free-vars! show!

; Operator - no free vars
'+ free-vars! show!

; Literal - no free vars
'42 free-vars! show!

; Function with one free var
'{ x } free-vars! show!

; Function with bound var - no free vars
'{ /x x } free-vars! show!

; Function with one free, one bound
'{ /x x y } free-vars! show!

; Multiple free vars
'{ x y z } free-vars! show!

; Nested function - inner needs x, outer binds it
'{ /x { x } } free-vars! show!

; Nested function - inner needs y, outer doesn't bind it
'{ /x { y } } free-vars! show!

; Nested function - inner needs both x and y, outer binds x
'{ /x { x y } } free-vars! show!

; Generator with free var
'[ x ] free-vars! show!

; Quoted term - no free vars (it's data, not a reference)
'{ 'x } free-vars! show!

; Complex: nested with multiple levels
'{ /a { /b { a b c } } } free-vars! show!

; Test env detection - should return 1 (failure)
'{ env } free-vars! { "unexpected success" } { 1 } ?! println!

; Test import detection - should return 1 (failure)
'{ "foo.froth" import } free-vars! { "unexpected success" } { 1 } ?! println!

; Test env in nested function - should return 1 (failure)
'{ /x { env } } free-vars! { "unexpected success" } { 1 } ?! println!

; Apply is OK - should return 0 with free var f
'{ f! } free-vars! show!
