; Test boundness analysis
; boundness returns (func-node) where node has 'term, 'body, 'free-vars-map, 'bound-set

; Helper to show boundness result
{ /map
  "free=" print map 'free-vars-map @ write
  " bound=" print map 'bound-set @ write
  " body=" print map 'body @ writeln!
} /show

; Test 1: {x /x x}
'{x /x x} boundness! show!

; Test 2: {/x [x] x}
'{/x [x] x} boundness! show!

; Test 3: {/x {x} x}
'{/x {x} x} boundness! show!

; Test 4: {x /x [/y x y] x y}
'{x /x [/y x y] x y} boundness! show!

; Test 5: {x /x {/y x y} x y}
'{x /x {/y x y} x y} boundness! show!

; Additional edge cases

; Empty function
'{} boundness! show!

; Single binder
'{/x} boundness! show!

; Deeply nested
'{/x {/y {x y}}} boundness! show!

; Multiple uses of same variable
'{/x x x x} boundness! show!

; Shadowing within generator
'{/x [/x x] x} boundness! show!

; Free before bound, closure after
'{x /x {x} x} boundness! show!

; Generator with free var
'{/x x {x} x} boundness! show!

; Generator shadows outer
'{x [/x x] x} boundness! show!

; Operators are not free variables (looked up in op-table)
'{x 10 *} boundness! show!

; Shadowed operator IS a bound variable
'{/+ x + y} boundness! show!

; Generator with different free var - y inside generator should use outer slot 1
'{x [y]} boundness! show!
