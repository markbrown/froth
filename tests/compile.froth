; Test compile module

; Test compile-func
0 '{/x x 1 +} compile-func! /addr
[] 0 close /f
5 f! println!

; Test compile-closure with captured variable
10 /y
0 {y 1 +} compile-closure! /compiled /addr
compiled! println!

; Test compile - success
{/a /b a b +} /add2
0 $ add2 'add2 : 'add2 compile! /new-env /addr
3 4 new-env 'add2 @ ! println!

; Test compile - not found
0 $ 'missing compile! . .

; Test compile - not a closure
0 $ 42 'x : 'x compile! . .

; Test compile - failed preflight
0 $ {env} 'bad : 'bad compile! . .

; Test nested closure
0 '{/x {x 1 +}} compile-func! /addr
[] 0 close /outer
5 outer! /inner
inner! println!
