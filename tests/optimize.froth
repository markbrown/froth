; Test closure optimization

; Create a closure with unnecessary bindings in scope
1 /a 2 /b 3 /c
{ a } /f

; Original closure has more than 3 bindings (a, b, c plus stdlib)
f fst # 3 > println!

; Optimize - should keep only 'a'
f restrict-closure-env!
{ /opt
  opt fst # println!          ; should be 1
  opt fst 'a @ println!       ; should be 1
  opt! println!               ; should work: prints 1
} { "FAIL" println! } ?!

; Closure with no free vars
{ 42 } /g
g restrict-closure-env!
{ /opt
  opt fst # println!          ; should be 0
  opt! println!               ; should work: prints 42
} { "FAIL" println! } ?!

; Closure using env - should fail
{ env } /h
h restrict-closure-env!
{ "unexpected success" println! } { 1 println! } ?!

; Closure using import - should fail
{ "foo" import } /i
i restrict-closure-env!
{ "unexpected success" println! } { 1 println! } ?!
