; Test liveness analysis

; Helper to run liveness and print result (shows the body array)
{ /map "body=" print map 'body @ writeln! } /test-liveness

; Basic cases
'{x} boundness! liveness! test-liveness!
; Free var x, last ref

'{x x} boundness! liveness! test-liveness!
; First x still live, second x last ref

'{/x x} boundness! liveness! test-liveness!
; Binder used, x is last ref

'{x /x x} boundness! liveness! test-liveness!
; Outer x last ref (free), binder used, inner x last ref

'{/x x x} boundness! liveness! test-liveness!
; Binder used, first x still live, second x last ref

'{/x} boundness! liveness! test-liveness!
; Binder unused (dead)

'{/x /y x} boundness! liveness! test-liveness!
; /x used, /y unused, x is last ref

; Nested closures - should have dead-set
'{x {x} x} boundness! liveness! test-liveness!
; x still live after closure, dead-set empty

'{x {x}} boundness! liveness! test-liveness!
; x's last use is this capture, in dead-set

'{x {/x x}} boundness! liveness! test-liveness!
; outer x not captured (shadowed), inner binder used

'{{x}} boundness! liveness! test-liveness!
; x's last use is capture

; Nested generators (share scope)
'{x [x] x} boundness! liveness! test-liveness!
; generator shares scope, x still live

'{x [x]} boundness! liveness! test-liveness!
; generator's x is last ref

'{x [/x x] x} boundness! liveness! test-liveness!
; generator binder is local and used

; Empty cases
'{{}} boundness! liveness! test-liveness!
; empty nested closure with empty dead-set

'{[]} boundness! liveness! test-liveness!
; empty generator

; Multiple variables
'{x y} boundness! liveness! test-liveness!
; both are last refs

'{x y x} boundness! liveness! test-liveness!
; first x still live

'{x y x y} boundness! liveness! test-liveness!
; first x and y still live

; Operators (not tracked in liveness)
'{1 2 +} boundness! liveness! test-liveness!
; literals and operators
